## 제7장 엔비디아와 반도체 전쟁

#### 청바지를 판매하는 엔비디아의 탄생
- `GPU(Graphics Processing Unit)` : 수천 개의 저렴한 코어를 사용해 병렬 연산을 가능하게 하는 장치
	- GPU는 마치 수천개의 색연필을 한꺼번에 사용해서 3차원 그래픽을 빠르게 완성하는 역할
	- 게임 그래픽 용도로 시작했으나 지금은 인공지능 개발에 필수적인 장비
	- GPU는 성능은 떨어지지만 매우 저렴한 코어를 많이 장착한 구조 <-> CPU는 성능이 좋은 코어를 몇개만 장착한 구조

- 엔비디아, 게임 그래픽 카드 회사로 출발했다가 현재는 인공지능 대표 기업이 됨
	- 게임 -> 애니메이션 그래픽스 -> 인공지능까지 GPU 활용성을 높임
	- GPU를 이용한 병렬연산을 연구하던 이언 벅(Ian Buck)을 영입하고 2006년 CUDA 런칭
- CUDA를 통해 C++ 언어로 GPU 코딩을 가능토록 하여 과학기술 연구자들의 접근성을 높임
- 엔비디아는 일찍이 SW에 투자를 해서 CUDA를 만듦. 따라서 수많은 연구나 자료들은 모두 CUDA를 기본으로 지원
	- IBM이 PC를 호환 기종으로 바꿀 시기에 SW를 별로 중요하게 여기지 않고 MS 운영체제를 공급하는 계약을 체결함. 정작 IBM보다 MS가 엄청난 수익을 벌게 됨. 엔비디아는 역사를 되풀이하고 싶지 않아서 SW에 일찍 투자함
	- GPU를 만드는 여러 회사들이 있지만 CUDA는 엔비디아 독점 기술. 타 회사 GPU에서 돌아가지 않는 연구나 코드도 엔비디아 GPU에서는 잘 작동됨
	- 현재도 모든 딥러닝 라이브러리가 CUDA를 우선으로 지원
	- 엔비디아 사례는 MS가 게임 개발 라이브러리를 제공해서 게임 개발에 매우 편리한 환경을 갖춘 것과 비슷. 따라서 대부분의 게임은 윈도우 전용
- 2016년 엔비디아는 슈퍼컴퓨터를 만들어서 첫 번째 장비를 오픈AI에 무상으로 기증
- 2022년 경쟁사를 압도하는 성능의 H100 GPU 출시
	- GPU 1장에 6천만원, 수요 폭발 기간에는 주문 후 1년씩 기다리기도 함
- 엔비디아는 CUDA 생태계와 최고의 GPU 성능으로 완전한 독과점 시장을 형성

- CUDA(Compute Unified Device Architecture) : GPU의 병렬연산을 게임 그래픽이 아닌 일반 용도로 활용할 수 있게 해주는 엔비디아의 독점 플랫폼


#### 세계 최고의 엔비디아 GPU와 이를 뒷받침하는 SK하이닉스 HBM
- 인공지능에 사용되는 GPU는 데이터센터 GPU라고 불리며 일반 GPU보다 훨씬 비쌈. AKA GPGPU(General Purpose Graphics Processing Unit)
	- 게임용 GPU와 데이터센터 GPU의 가장 큰 차이점은 메모리. 게임용 GPU 24GB vs. 데이터센터 GPU 80GB 높은 메모리를 가지고 있어 더 많은 일을 쉽게 할 수 있음
- 메모리는 컴퓨터의 모든 장치 중에서 가장 빠르기 때문에 속도보다 용량이 중요함
	- 따라서 컴퓨터의 속도를 높이려면 메모리를 많이 다는 것이 중요
	- 하지만 딥러닝이 본격적으로 활용되면서 메모리가 훨씬 더 빨라져야 하는 상황 발생
	- Why? 딥러닝은 많은 데이터로 계산을 하는 작업. 대용량 데이터 계산을 반복해야 하는 작업
- 그래서 필요한 장치가 `HBM(High Bandwidth Memory, 고대역폭 메모리)`
- SK하이닉스 HBM 독점으로 엔비디아 납품되어 GPU에 탑재
- 기존 메모리는 CPU와 떨어져 있었는데 HBM은 GPU 바로 옆에 위치하고 훨씬 더 많은 연결을 함
	- 이로 인해 더욱 빠른 초고속 통신이 가능(거리도 짧아지고 데이터의 양도 많아짐)
	- 메모리를 수직으로 쌓아 올리고 구멍을 뚫어 연결한 구조


#### 전 세계는 반도체 전쟁 중
- 디지털 세상을 구성하는 가장 중요한 구성품이 바로 반도체
- 반도체는 일반적으로 '시스템 반도체'와 '메모리 반도체'로 구분
- 반도체 산업의 역사
	- 1990년대 이전, 세계 최초로 반도체를 개발한 미국을 중심으로 유럽과 일본 업체가 추격전을 벌이는 상황
		- (유럽) 필립스, 지멘스 (일본) 도시바, NEC, 히타치, 후지쯔, 미쓰비시 등
	- 일본 기업은 높은 기술력과 저렴한 가격으로 치킨게임을 벌이기 시작함
	- 미국의 반도체 기업들은 급속히 위축되었고 대부분 시장에서 철수
		- 인텔은 메모리 반도체로 시작한 회사이지만 CPU(시스템 반도체의 종류)가 대박 나 시장을 독점하게 되면서 시스템 반도체 1인자가 되었지만 인텔의 시작이었던 메모리 반도체 분야에 애정도 각별했으나 결국 일본 때문에 메모리 반도체 사업을 포기
	- 일본 기업이 메모리 반도체 시장을 점령하다 미국 정부가 개입하여 제재를 가하자 일본 업체들도 무너짐
	- 이 혼란 속에서 우리나라는 메모리 반도체 기술을 꾸준히 발전시켜 나가면서 삼성전자, SK하이닉스가 세계 1, 2위를 차지(24년 기준 두 기업의 시장 점유율은 75% 정도)


#### 엔비디아를 맹렬히 추격하다: AMD, 구글, 인텔, 아마존, 마이크로소프트, 메타
- `인공지능 가속기(AI Accelerator)` : LLM의 학습 및 추론 속도를 높이는 특화된 전용 HW
- 다른 인공지능 가속기들은 어떤 것들이 있을까?
1) AMD
- 엔비디아가 게임 그래픽 카드를 생산하던 시절 경쟁사였던 ATI를 인수함
- 엔비디아의 CUDA와 유사한 AMD ROCm 플랫폼 2016년에 출시
- AMD의 대표인 리사 수(Lisa Su)는 대만 태생으로 MIT에서 반도체로 박사 학위를 받은 연구자 출신 CEO
	- 회사가 적자로 어려운 시기에 GPU의 가격을 낮춰 가성비를 높이고 콘솔에 탑재되는 CPU에 집중하는 전략 등을 통해 파산 직전에서 AMD를 살려냄

2) 구글
-  `TPU(Tensor Processing Unit)`: 행렬 연산을 최적화하여 고속으로 수행하는 장치. 구글은 GPU 대신 TPU라는 명칭을 씀. 
	- 수축기 배열(systolic array) 구조 도입 등 기존 GPU보다 대규모 행렬 연산을 효율적으로 수행하고 전력 소비도 낮음. 구글 클라우드를 이용하면 유료로 누구나 사용 가능
		- 수축기 배열: 데이터가 맥박처럼 배열 내부에서 흐르는 구조
	- 놀라운 점은 칩 개발이 복잡한 기술임에도 불구하고 구글은 15개월이라는 단시간 내 완수
		- 구글 팀에서 아키텍쳐 설계 > 브로드컴에서 설계를 칩으로 전환 > TSMC에서 생산 > 서버 배포
	- 알파고가 구글의 TPU를 이용해 개발된 프로그램
- `텐서(Tensor)`: 데이터를 다차원 배열에 표현하는 기본 단위. 딥러닝에서 값을 표현하는데 사용
- `텐서플로(TensorFlow)`: 구글의 딥러닝 라이브러리

3) 인텔
- 전 세계 반도체 분야에 엄청난 영향력을 끼친 기업
	- 인텔 창업자 집적 회로(Integrated Circuit)을 세계 최초로 만든 사람(로버트 노이스)
	- 무어의 법칙 같은 용어도 인텔에서 나온 말(고든 무어)
	- 1971년 상업적 용도의 CPU를 세계 최초로 만듦
	- 전성기 때는 CPU 시장의 80% 이상 점유
	- 1991년 Intel Inside 브랜드 캠페인으로 컴퓨터 핵심부품인 CPU를 일반 소비자에게 각인 시키는데 큰 역할을 함
- 하지만 모바일 시대가 열릴 때 적응하지 못해서 뒤쳐지게 됨
- `가우디(Gaudi)`: 인텔의 인공지능 가속기. 이스라엘 반도체 기업 하바나랩스가 만든 제품인데 2019년도에 기업을 인수해서 인텔이 발전시킨 모델
- 인텔은 CUDA에 대항하기 위해 통합 가속단체(UXL, Unified Acceleration Foundation)을 조직해서 오픈 생태계를 만들려고 노력함
	- 이 단체에는 인텔, 구글, 퀄컴, 삼성 등이 참여해서 CUDA와 유사한 SW를 오픈소스로 만들어서 모든 GPU가 구동할 수 있게 만듦
	- `원API(oneAPI)`: 단일 API로 모든 장비에 사용할 수 있게끔하는 장비. 엔비디아의 CUDA가 자사 GPU에서 동작하는 것과 대조적
- 인텔은 네이버와 공동 연구소를 설립하기로 협약을 맺고 인텔의 인공지능 칩인 가우디를 기반으로 SW 생태계를 함께 구축할 예정

4) 자체적인 인공지능 가속기를 만드는 회사들
- 빅테크 기업 대부분 엔비디아 의존도를 낮추기 위해 자체적인 인공지능 가속기를 제작
	- 메타의 칩은 자사 추천 모델에 특화된 칩 제작
- 전 세계 3대 클라우드 서비스인 AWS, GCP, Azure 모두 자체 칩을 이용한 딥러닝 서비스 제공
	- 아마존 자체 칩 개발하고 AWS를 통해 서비스 제공하고 있는데 GPU 대비 절반 가격으로 저렴하게 제공
		- 엔트로픽에 대규모 투자를 단행하면서 아마존 칩을 사용하는 조건을 내세움
	- MS의 칩은 Azure에서 사용 가능하며 인텔이 제조. 과거는 인텔이 CPU를 만들고 MS가 SW를 공급하는 역할이었는데 이제는 MS가 칩을 설계하고 인텔이 생산해주는 역할로 바뀜.
- 인공지능 가속기는 더 이상 GPU라고 할 수 없음. 그래픽 처리보다 더 많은 일을 하기 때문. 따라서 인공지능 가속기는 NPU라고 부름
- `NPU(Neural Processing Unit)`: 인공 신경망 처리를 위해 만든 전용 장치. 현재 GPU를 만드는 엔비디아, 인텔, AMD를 뺀 나머지 기업에서 만드는 장치를 모두 NPU라고 함


#### 엔비디아와 다르게 경쟁하다: 애플, 그록, 텐스토렌트, 퓨리오사AI, 하이퍼엑셀
1) 온디바이스 AI
- 애플은 자체적으로 NPU 아키텍쳐를 개발하여 아이폰에 탑재. 모바일 칩은 CPU와 NPU를 하나의 단일 칩으로 만들어서 탑재하는데 이걸 `모바일 AP(Application Processor)`라고 부름
- 여러 기능을 하나로 하나의 칩에 통합했다는 뜻으로 `시스템 온 칩(System on Chip, SoC)`라고도 부름
- 애플의 NPU는 모바일 AP에 포함되어 다양한 인공지능 서비스 제공
	- 사물이나 인물 자동인식, 음식을 찍을 때 자동으로 음식 모드로 전환 등 
- 삼성 또한 갤럭시에 모바일 AP 탑재
- 모바일에서 NPU를 이용해 직접 인공지능 서비스를 제공하는 것을 `엣지 AI(Edge AI)` 또는 `온디바이스 AI(On-Device AI)`라고 하는데 최근 매우 주목 받고 있는 분야
	- 이유는 보안 때문. 챗GPT 같은 서비스 사용 시 오픈AI 서버에 내 질문이 전송된다는 뜻인데 오픈AI 측에서 데이터를 보거나 학습시킬 수 있음. 따라서 기업에서는 사용을 금지하는 경우도 발생
	- 온디바이스 AI는 데이터를 외부 서버로 보내지 않고 기기 내에서 바로 처리하기 때문에 정보의 유출 위험이 적음
- 온디바이스 AI는 데이터가 클라우드 서버로 전송되어 처리되는 기존 방식과 달리 기기 자체에서 인공지능 연산을 처리하기 때문에 속도 또한 매우 빠름. 특히 인터넷이 원활하지 않은 나라에서 장점이 됨
- 스마트폰 기능이 점점 강력해지면서 온디바이스 AI는 점점 늘어날 것이며 LLM을 스마트폰에서 구동하는 경우가 더 많아질 것. (챗GPT나 클로드 같은 클라우드 기반 서비스보다는 성능이 떨어지겠지만 보안이 중요한 분야에서는 이런 로컬 LLM이 별도 시장을 형성할 것)

2) 그록, 현존하는 가장 빠른 인공지능 가속기
- 그록의 인공지능 가속기를 LPU(Language Processing Unit)으로 부르며 다른 칩에 비해 LLM을 엄청 빠르게 서비스할 수 있다면서 LLM에 특화된 칩임을 강조
	- 엔비디아 GPU에 HBM을 속도를 개선했듯이 SRAM이라는 GPU 코어 안쪽에 탑재된 메모리를 사용해서 속도를 HBM보다 더 빠르게 구현(엔비디아 H100 보다 약 24배 빠름)
	- 다만, 구족가 복잡하고 용량이 적고 가격도 비쌈
	- 다소 무식한 방법이지만 SRAM으로만 LLM이 돌아갈 수 있도록 여러 장의 칩을 하나로 연결(70B 모델을 돌리기 위해 600여장의 칩을 하나로 연결한 것과 비슷)
	- 빠른 속도를 강점으로 유로 API를 클라우드를 통해 제공하고 있으며 앞으로 더 빠르고 전력효율도 좋은 차세대 칩을 개발할 예정

3) 세레브라스, 세계 최대 크기의 칩
- 세레브라스(Cerebras)는 웨이퍼 스케일 엔진(Wafer Scale Engine)이라는 세계 최대 크기 칩을 제작
	- 보통 GPU 같은 칩은 한 웨이퍼에 여러 개를 만들고 이를 잘라서 사용하는데 세레브라스는 웨이퍼 전체가 하나의 칩
- 그록과 마찬가지로 SRAM을 활용. 무려 44GB 탑재했으며 그만큼 가격도 비싸고 전력 사용이 큼
- 2017년 오픈AI가 자체 반도체를 확보하기 위해 세레브라스 인수를 검토했었음

4) 텐스토렌트
- 반도체 업계의 전설적인 인물인 짐 켈러(Jim Keller)가 대표인 회사이며 현대차에서 5천만 달러를 투자함
	- AMD, 애플, 테슬라에서 일하며 주요 칩 개발을 주도한 인물
- 인공지능 가속기 주요 기업들과 달리 접근 방식이 다름 빠르고 비싸기 보다 저렴하면서도 대중적인 인공지능 가속기 만드는 것이 목표
- 텐스토렌트의 최신 제품인 `웜홀(Wormhole)` 칩 하나가 약 130만원(엔비디아 H100는 6천만원)이며 핵심 SW 모두 오픈소스로 진행
- GPU 해커들을 위한 놀이터를 만들고 참여를 유도하는 전략으로 운영

5) 퓨리오사AI
- 2017년 우리나라에 설립된 팹리스(Fabless) 스타트업이며 AMD와 삼성전자에서 반도체를 연구하던 백준호 대표가 이끄는 회사
- LLM에 최적화된 레니게이드(RNGD)는 엔비디아와 동일한 HBM을 장착하고 스펙도 크게 차이 나지 않지만 저전력으로 동작하기 때문에 더욱 효율적인 칩
	- 구글이 TPU에 수축기 배열 구조를 채택해 성능을 높였다면 레니게이드는 TCP라는 아키텍쳐를 채택해 효율성을 높임
		- 고정된 크기의 데이터만 처리하는 수축기 배열 구조와 달리 TCP는 동적으로 재배치할 수 있는 더 작은 컴퓨팅 유닛을 가지고 있어 더욱 유연하게 동작
- 엔비디아 CUDA에서 다양한 딥러닝 모델을 구동하기 어렵다는 것과 달리 퓨리오사AI는 파이토치 지원으로 해결하고 함
- 2025년 초 메타가 퓨리오사AI 인수를 검토했지만 이뤄지지는 않음. 퓨리오사AI가 거절 후 LG AI연구소와 협약 체결

6) 하이퍼엑셀
- 카이스트 김주영 교수가 창업하고 삼성전자에서 반도체를 연구하던 이진원 CTO가 합류한 반도체 스타트업
- AI 연산에서 가장 중요한 연산과 메모리 기능의 성능 균형에 초점을 둠
	- 일반적으로 LLM은 추론할 때 계산이 먼저 진행되고 이후에 계산 결과가 메모리를 통해 다른 장비에 순차적으로 전달되는 구조라서 계산이 끝날 때까지 다른 장비는 계산 결과를 기다려야 하는 지연 발생
	- 하이퍼엑셀은 적절히 비율을 조절하여 계산과 메모리 전송이 동시에 진행되도록 하여 지연 시간을 대폭 개선


#### TSMC, 모두가 청바지 원단 회사를 꿈꾸며
- 앞서 소개한 기업들은 모두 반도체 설계만 하지 생산하진 않음. 이를 대신 생산해주는 회사가 TSMC.
- 미국에서 반도체 엔지니어로 일하던 모리스 창이 고국인 대만으로 돌아와 1987년에 설립한 회사
	- 대만 정부가 반도체 업계의 거물이었던 모리스 창에게 고국으로 돌아와 반도체 기업을 이끌어달라 요청
- 당시에는 반도체 설계와 생산을 한 업체에서 했는데 앞으로 반도체 시장은 설계를 전문으로 하는 팹리스(Fabless) 기업과 제조를 위탁 받아 생산을 전문으로 하는 파운드리(Foundry) 기업으로 나뉠 것으로 전망했고 생산에 집중하기로 결정
	- 이런 모리스 창의 예측은 정확했고 전 세계 반도체 산업의 판도를 크게 바꿈
- 앞서 소개한 모든 기업들은 모두 팹리스 회사. 엔비디아도 공장을 가지고 있지 않는 팹리스 회사임. TSMC는 고객이 설계도를 가져오면 그대로 제작해주는 공장 전문 하청 업체
- 반도체 쪽 승자가 누구나에 상관 없이 돈을 벌 수 있음. 반도체 부분에서 매출이 압도적으로 1위
- 반도체는 반도체 소자를 하나의 칩으로 구현한 것인데 이를 직접 회로(Integrated Circuit)라고 함

- 과거 반도체 양산은 생산직 직원들이 손으로 붙여야 하는 대표적인 노동 집약적 산업이었음
	- 인텔은 1960년 반도체 기업들의 경쟁이 심해지자 반도체 생산 단가를 낮추기 위해 인건비가 저렴한 해외로 생산 공장을  홍콩으로 이전
	- 홍콩의 성과가 좋아서 다른 아시아 국가를 찾다 1966년 우리나라 구로공단에 반도체 공장을 구축하여 운영
- 이제 반도체 생산은 더이상 손으로 조립하진 않지만 여러 기업의 손을 거쳐 만들어짐
	- 모바일 칩으로 예시를 들면 반도체 설계를 영국의 ARM으로부터 라이선스를 취득해 사용
	- 반도체 설계에는 특수한 SW 사용됨. 케이던스, 시놉시스, 지멘스EDA 등 모두 미국 회사
	- 설계를 완성하면 TSMC에 생산을 의뢰
	- TSMC가 최신 공정으로 생산하기 위해서는 네덜란드 ASML에서 만드는 극자외선 리소그래피 장비 필요(엄청나게 미세한 빛을 쏴줄 수 있는 노광장비). ASML이 없으면 TSMC도 생산을 멈출 수 밖에 없음
	- 네덜란드 ASML의 장비를 만들기 위해 독일의 TRUMF에서는 정밀 레이저, 독일 ZEISS에서는 매끄러운 표면의 거울, 미국의 Cymer는 광원장비 등 5100개 이상의 공급업체 필요 (특히 기업명이 명시된 업체들은 해당 장비를 납품할 수 있는 세계 유일한 회사들)
	- 2025년 기준 TSMC의 3나노 최신 공정은 세계 최고 수준. 따라서 애플은 TSMC의 최신 공정을 거의 독점 사용 중
- 반도체 소재도 소수 기업에 극단적으로 쏠려 있는 공급망 체계를 가지고 있음
	- 반도체는 기본적으로 모래에서 추출한 실리콘으로 제작. 모래는 전세계 어디에나 있기 때문에 반도체 대중화에 크게 기였지만 현재는 반도체 성능이 급격히 향상 되면서 '실리카 샌드'라는 훨씬 좋은 품질의 고순도 석영 모래가 필요
	- 하지만, 실리카 샌드는 전세계 딱 한 군데, 미국의 스프루스 파인(Spruce Pine)에서만 생산됨
	- 다국적 광산 기업인 노르웨이 더쿼츠코프는 스프루스 파인에서 모래를 채굴해 노르웨이 북부 드래그로 운반하여 모래를 정제하여 고순도 실리콘 원료로 처리
	- 일본 전문 소재업체에서 순도 99.999...%가 된 모래를 노르웨이에서 받아 고순도 실리콘을 잉곳으로 제작하여 웨이퍼로 만듦
	- 실리콘 웨이퍼를 대만의 TSMC나 삼성전자에서 반도체를 생산하는데 사용


#### 중국의 도전 vs 미국의 견제
- 반도체 설계와 생산은 정교한 글로벌 공급사슬망에 의해 완성됨
- 따라서 이 세상에 모든 것을 생산해내는 중국조차 고전을 면치 못함. 미국의 강력한 제재 속에 자체 반도체 생산 공정을 갖추려고 하지만 다양한 글로벌 기업이 저마다 핵심 기술을 보유하고 있기 때문에 중국이 대체하기 불가능이 가까움
	- 중국 정부로부터 20조원을 투자 받으며 야심 차게 도전했던 HSMC라는 파운드리 회사는 TSMC의 CTO를 역임했던 장상이를 CEO로 영입했지만 2020년 문을 닫음
- 미국은 반도체 제조를 다시 미국으로 옮겨가기 위해 반도체법을 시행
	- TSMC의 성공을 보며 다시 제조를 미국 내에 들이려고 노력 중
	- 인텔도 파운드리 사업에 도전, 미국 애리조나주에 공장을 짓고 미국 정부로부터 최대 85억 달러 규모의 자금을 지원 받을 계획
	- 삼성전자는 텍사스주에 새로운 반도체 공장을 짓고 있으며 TSMC도 애리조나 피닉스에 공장 건설 예정
- LLM의 크기가 커질수록 더 좋은 성능을 내는 규모의 법칙으로 인해 기업이 모델의 크기에 더욱 집중하는 중
	- 모델의 크기를 키우기 위해서는 학습과 추론 모두 대규모의 GPU가 필요하기 때문에 많은 기업이 인공지능 반도체 인프라에 엄청난 투자를 하는 중


#### ***comments***
p.289 IBM PC 호환 기종 사례 찾아보기
p.295 엔비디아의 영업이익률은 66%. 100원을 받고 GPU를 팔면 종업원 월급을 다 주고도 66원이 남는다는 뜻. 시장가치로만 보면 엔비디아 = 삼성전자 14개 
p.325 반도체 업계의 짐 켈러 같은 IT 산업의 전설적인 인물들이 단순히 자신의 이익만을 위한 행동을 하는게 아니라 playing field를 확장하는 방향을 목표로 하는 점이 너무 매력적이다. 그런 방향성이 이 산업의 큰 가치로 여겨지는게 가장 큰 몫을 하는 듯
p.327 퓨리오사AI는 결국 메타 인수 제안 거절 후 LG AI연구소와 협약 체결함. 내막은 잘 모르겠으나 우리나라 인공지능을 위해서라도 잘 된 일인 것 같음
p.330 반도체의 나라에서 태어나서 이제야 제대로 배운것 같음 ㅎㅎ
p.332 반도체는 모래에서 추출한 실리콘으로 만드는데 실리콘밸리의 이름도 반도체 소재에서 유래
p.345 HSMC 왜 망했는지 궁금함. 장상이 인터뷰 찾아보고 싶음