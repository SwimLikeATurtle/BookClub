## 제4장 검색엔진 : 구글이 세상을 검색하는 법

#### 검색엔진 등장하다
 - 인터넷 초창기(90년대) 인터넷의 첫 관문 = 디렉토리 서비스
 - 과거 야후는 디렉토리를 메인 서비스로 제공했으며 디렉토리에 노출되지 않는 경우 검색을 사용하도록 운영(구글 검색 서비스 사용)
 - 이후 사람들이 검색엔진에 의존한다는 사실을 뒤늦게 깨닫고 검색 서비스를 도입하지만 결국 구글에 밀림

#### 엄청난 돈을 벌어들이다
- 초기 인터넷 광고는 신문 광고와 비슷하게 노출 횟수에 따라 가격 산정
- 검색 엔진의 수익모델 :
    - 쿼리에 적합한 광고를 타깃에 다라 다르게 보여주는 '타깃 마케팅' 진행하고 사용자 피드백을 기반으로 광고료를 선정하는 'cost per click(CPC)' 방식 도입
    - 검색 광고는 경매식으로 가격 산정했으나 단순히 단가가 높다고 광고가 노출되는게 아니라 CPC와 함께 높이도록 설계
    - 입찰 광고 최적화 시 클릭률 예측 알고리즘 매우 중요
- 위 비즈니스 모델로 구글은 성장했으며 현재 구글의 매출에서 광고 수익이 80% 차지


#### 엄청난 문서를 수집하다
- `색인(Index)`: 검색엔진이 인터넷에 있는 문서를 수집하여 검색에 적합하도록 보관하여 검색을 빠르게 수행하는 것을 도움
- `구글 파일 시스템(Google File System)` : 구글의 효율적인 분산 파일 시스템. 웹상의 많은 문서를 저렴한 컴퓨터에 나눠서 저장하는 방식을 활용하며 초기 빅데이터의 원형이 됨
- `크롤러(Crawler)` : 웹사이트에서 정보를 수집하는 로봇. 웹 문서를 방문할 때마다 특수한 데이터베이스인 Index에 정보를 긁어와서 추가함
- 크롤러 작업 방식 :
    - URL을 방문해서 사이트 내 웹 문서의 모든 링크 식별한 뒤 목록에 추가
    - 방문한 웹 문서에서 필요한 내용 추출해서 저장
    - 웹 문서의 정보를 제대로 추출하기 위해서는 크롤러의 성능 중요
    - 스케줄러: 한번 방문한 사이트는 일정 시간 재방문하지 않도록 정책 관리 
    - 선택 정책(selection policy): 많은 웹문서 URL 중 어떤 페이지를 먼저 방문할지를 관리하는 정책


#### 검색엔진은 어떻게 검색할까?
- 색인은 쿼리의 단어가 포함된 페이지를 나열하고 쿼리의 단어가 동일한 단어가 많은 페이지를 모두 보여줌
- 이 페이지들 중 어떤 순서를 먼저 보내줄지에 대해서는 랭킹 기능 활용


#### 랭킹, 수십조 가치의 줄 세우기 기술
 -  서로 다른 성질을 가진 대상을 정량적으로 비교할 때 순서를 세우면 매우 합리적이지만 하나의 기준으로 순서를 정하기는 어렵기 때문에 종합적인 면을 모두 고려해야함
    - 구글은 검색에서 200여 가지의 랭킹 조건을 이용함
    >  * Pecking Order : 1921년 노르웨이 동물학자가 마당에 닭들이 어울리는 행태를 지켜보다 닭들 사이에 존재하는 위계질서가 모이를 쪼아 먹는 순서를 보고 명칭함


#### 최신 문서를 찾아서
- 정보가 계속 업데이트 되기 때문에 최신 문서일수록 점수 높음 


#### 품질 좋은 문서를 찾아서
- 품질 높은 문서 = 길이가 길거나, 권위 있는 사이트에 게재된 문서 등


#### 페이지 랭크, 구글의 역사가 탄생하다
- `페이지 랭크(Page Rank)`: 권위 있는 사이트에 링크가 많이 걸릴 수록 문서 품질에 대한 점수가 올라가는 방식(논문 인용 횟수처럼)
    - 1998년 세르게이 브린과 래리 페이지는 문서의 품질을 평가하는 알고리즘 고안
    - 권위 있는 사이트가 많이 참조할수록 순위가 올라가기 때문에 스팸 사이트가 상위에 올라오지 않도록 방어
- `댐핑 팩터(Damping Factor)`: 사용자들이 싫증을 내서 문서에서 이탈할 확률을 반영한 값


#### 쿼리에 딱 맞는 문서 찾는 법
- `근접도(Proximity)`: 사용자가 입력한 쿼리가 문서 어디쯤에 위치하는지 순서대로 매치이되는지 판단하는 항목
    - 위치: 제목 > 본문, 제목에 있을수록 점수 높음
    - 순서: 쿼리의 순서대로 배치될 경우, 쿼리의 단어와 단어 사이의 간격이 좁을수록 점수 높음


#### TF-IDF 그리고 마법 같은 BM25
- `TF-IDF(Term Frequency-Inverse Document Frequency)`: '단어의 출현 빈도(TF)'와 '문서 출현 빈도의 역수(IDF)'를 고려하는 검색엔진과 추천 시스템을 대표하는 알고리즘
- `BM25(Best Matching 25)`: TF-IDF를 기반으로 하는 점수 계산 방식 중 가장 성능이 좋다고 알려진 가중치 조합(TF-IDF 보다 합리적)
    - 문서 내 해당 단어가 많이 나올수록(TF), 다른 문서에는 해당 단어가 포함되어 있지 않을수록(IDF) 점수가 커지는 계산 방식
    - 다른 문서에 등장한 적이 없는 희귀한 단어는 값이 높고, 빈번하게 나오는 단어는 값이 낮음


#### A/B 테스트, 검색 개선을 확인하는 법
- A/B 테스트 : 한 그룹은 개선된 조건으로 실험을 수행하고 다른 그룹은 기존 조건으로 실험하여 결과를 비교하는 방식으로 과학 분야에서 사용하는 무작위 대조 시험(Randomized Controlled Trial)
    - 데이터 분석 분야에서 인과관계를 밝히는 일은 어려운데 A/B 테스트가 해결책이 되어줌
    - 실제 사용자들이 좋아하는 방안이 무엇인지 확인할 수 있는 방법 (eg. 개선된 랭킹 알고리즘이 더 좋다면 기존 대비 클릭룰이 늘어날 것)
    - 따라서 A/B 테스트는 데이터를 근거로 서비스를 개선하고 기업이 데이터 기반 의사 결정을 하는데 가장 핵심적인 역할을 함


#### 검색엔진 최적화, 창과 방패의 싸움
- `검색엔진 최적화(Search Engine Optimization)`: 웹사이트를 검색엔진에서 높은 순위에 랭크 시키기 위한 방법
- 쿼리를 입력했을 때 가장 먼저 나오는 사이트가 매출을 많이 낼 수 있기 때문에 업체들은 랭킹을 높이기 위해 노력하며, 검색엔진 업체들은 랭킹을 쉽게 조작할 수 없도록 계속해서 방어 로직을 개선


#### 점점 더 똑똑해지는 구글 검색의 진화
- 이제는 단순히 문서가 해당 단어를 포함하는지 여부를 판단하는게 아니라 딥러닝으로 단어와 단어 사이의 관계, 쿼리의 맥락을 파악하고 문장의 의미를 정확하게 이해해서 정답을 찾아주는 역할을 수행
- 딥러닝은 검색의 결과 뿐만 아니라 쿼리의 오타 자동 교정 등 사용자 편의에도 도움 제공
- `MUM(Multitask Unified Model)`: 2021년 구글에서 발표한 기술로 복잡한 질문에 답하기 위해 딥러닝을 결합한 기술
    - 75개의 언어를 이해하는 것은 물론 생성 가능, 멀티모달로 여러 유형의 데이터를 이해할 수 있으며, 멀티태스킹도 수행 가능